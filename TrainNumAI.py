import torch
import torch.nn as nn 
from torch.utils.data import Dataset, DataLoader
import torch.optim as optim

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")

class CustomDataset(Dataset):
    def __init__(self, num_samples, variations_per_digit):
        self.num_samples = num_samples
        self.variations_per_digit = variations_per_digit
        self.data, self.labels = self.generate_data()

    def generate_data(self):
        data = []
        labels = []

        for label, num_variations in self.variations_per_digit.items():
           for variation in range(1, num_variations + 1):
                digit_grid = self.create_digit_grid(label, variation)

                data.extend([digit_grid] * (self.num_samples // (sum(self.variations_per_digit.values()))))
            
                labels.extend([label] * (self.num_samples // (sum(self.variations_per_digit.values()))))

        return data, labels

    def create_digit_grid(self, digit, variation):
        digit_grids = {
        0: [
            [[1, 1, 1, 1, 1],
             [1, 0, 0, 0, 1],
             [1, 0, 0, 0, 1],
             [1, 0, 0, 0, 1],
             [1, 1, 1, 1, 1]],


            [[1, 1, 1, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 1, 1, 1, 0]],

            [[0, 1, 1, 1, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 1, 1, 1]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],
            
            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
            
            [[1, 1, 1, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 1, 1, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 1, 1, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 1, 1, 1, 0]],
        ],
        1: [
            [[0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0]],

            [[1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0]],

            [[0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0]],
             
            [[0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0]],       

            [[0, 0, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 0]],     

            [[0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 0]],

            [[1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 0, 0, 0]],
        ],
        2: [
            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1]],

            [[1, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [1, 1, 1, 1, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 1, 0]],

            [[0, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 1, 1, 1, 1],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 1]],

            [[1, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [1, 1, 1, 1, 1],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 1, 1]],

            [[0, 1, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 1, 1, 1, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 1, 1, 1, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 1, 1]],

            [[0, 1, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 1, 1, 0]],
            
            [[0, 0, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 1, 1]],

            [[1, 1, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 0, 0]],
             
            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 0, 0]],
            
            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 1, 1]],

            [[0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1]],

            [[0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0]],
             
            [[0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 0]],

            [[0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 0, 0]],

            [[1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 0, 0, 0]],
            
            [[0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 0]],
            
            [[0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 1]],
        ],
        3: [
            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
            
            [[0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 1]],

            [[0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 0]],

            [[0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 0, 0]],

            [[1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 1, 0, 0, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
        ],
        4: [
            [[1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],
            
            [[0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],
            
            [[0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],
            
            [[0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0]],
            
            [[0, 0, 1, 0, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 1, 0, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[1, 0, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],
        ],
        5: [
            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
            
            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 0, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 0, 0, 0]],

            [[0, 1, 1, 1, 1],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 1, 1, 1, 1]],

            [[1, 1, 1, 1, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [1, 1, 1, 1, 0]],

            [[1, 1, 1, 1, 1],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [1, 1, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 1, 1, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 0, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 0, 0, 0]],
        ],
        6: [
            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[1, 1, 1, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],

            [[1, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
            
            [[0, 1, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 1, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 0, 1, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 0]],

            [[0, 1, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 0, 0]],

            [[1, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 0, 0, 0]],
             
            [[0, 0, 1, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 1, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 0, 1, 0]],

            [[0, 1, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 1, 1, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 0, 1, 0, 0]],
            
            [[1, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [1, 1, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [0, 1, 0, 0, 0]],
        ],
        7: [
            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[1, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],
            
            [[0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],
            
            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0]],

            [[0, 0, 0, 0, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0]],

            [[0, 0, 0, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0]],

            [[1, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[1, 1, 1, 1, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 0, 0, 0]],

            [[1, 1, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0]],
            
            [[0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 0, 0, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [0, 0, 0, 0, 0]],

            [[1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 0, 0, 0],
             [0, 0, 0, 0, 0]],
        ],
        8: [
            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0], 
             [0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 1, 1, 1],
             [0, 1, 0, 0, 1],
             [0, 1, 1, 1, 1]],

            [[1, 1, 1, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 1, 1, 1, 0],
             [1, 0, 0, 1, 0],
             [1, 1, 1, 1, 0]],

            [[1, 1, 1, 1, 1],
             [1, 0, 0, 0, 1],
             [1, 1, 1, 1, 1],
             [1, 0, 0, 0, 1],
             [1, 1, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [1, 0, 0, 0, 1],
             [0, 1, 1, 1, 0],
             [1, 0, 0, 0, 1],
             [0, 1, 1, 1, 0]],

            [[0, 0, 0, 1, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 0, 1],
             [0, 0, 0, 1, 0]],

            [[0, 0, 1, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 0, 1, 0],
             [0, 0, 1, 0, 0]],

            [[0, 1, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [0, 1, 0, 0, 0],
             [1, 0, 1, 0, 0],
             [0, 1, 0, 0, 0]],
        ],
        9: [
            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [0, 1, 1, 0, 0]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 0, 1, 1, 0]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 0, 1, 1]],

            [[0, 0, 1, 1, 1],
             [0, 0, 1, 0, 1],
             [0, 0, 1, 1, 1],
             [0, 0, 0, 0, 1],
             [0, 0, 1, 1, 1]],

            [[0, 1, 1, 1, 0],
             [0, 1, 0, 1, 0],
             [0, 1, 1, 1, 0],
             [0, 0, 0, 1, 0],
             [0, 1, 1, 1, 0]],
            
            [[1, 1, 1, 0, 0],
             [1, 0, 1, 0, 0],
             [1, 1, 1, 0, 0],
             [0, 0, 1, 0, 0],
             [1, 1, 1, 0, 0]],
        ]
        }

        grid = digit_grids[digit][variation - 1]

        pad_width = 5 - len(grid)
        padded_grid = torch.nn.functional.pad(torch.tensor(grid, dtype=torch.float32), (0, 0, pad_width, 0), value=0)
        return padded_grid

    def __len__(self):
        return self.num_samples

    def __getitem__(self, idx):
        x = self.data[idx % len(self.data)]
        y = self.labels[idx % len(self.labels)]
        return x, y

class SimpleModel(nn.Module):
    def __init__(self):
        super(SimpleModel, self).__init__()
        self.fc = nn.Linear(25, 16)
        self.relu = nn.ReLU()
        self.fc2 = nn.Linear(16, 10)

    def forward(self, x):
        x = self.fc(x)
        x = self.relu(x)
        x = self.fc2(x)
        return x

num_samples = 500000
variations_per_digit = {
    0: 25,
    1: 48,
    2: 23,
    3: 10,
    4: 24,
    5: 16,
    6: 12,
    7: 32,
    8: 10,
    9: 6
}

dataset = CustomDataset(num_samples=num_samples, variations_per_digit=variations_per_digit)

dataloader = DataLoader(dataset, batch_size=64, shuffle=True, pin_memory=True)

model = SimpleModel()
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
model = model.to(device)
optimizer = optim.Adam(model.parameters(), lr=0.001)
criterion = nn.CrossEntropyLoss()

epochs = 50
for epoch in range(epochs):
    for inputs, labels in dataloader:
        inputs, labels = inputs.to(device), labels.to(device)

        outputs = model(inputs.view(-1, 25)) 

        loss = criterion(outputs, labels)

        optimizer.zero_grad()
        loss.backward()
        optimizer.step()

        
        print(f'Epoch: {epoch}, Loss: {loss.item()}')

torch.save(model, 'trained_model.pth')
